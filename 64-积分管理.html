<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>积分管理 - 香草生活后台管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .points-animation {
            animation: pointsGlow 2s ease-in-out infinite alternate;
        }
        @keyframes pointsGlow {
            from { box-shadow: 0 0 5px rgba(16, 185, 129, 0.3); }
            to { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); }
        }
        .rule-item {
            transition: all 0.3s ease;
        }
        .rule-item:hover {
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 侧边栏 -->
    <div id="sidebar" class="fixed left-0 top-0 w-64 h-full bg-white shadow-lg transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-30">
        <div class="p-6 border-b border-gray-200">
            <h1 class="text-xl font-bold text-gray-800">香草生活</h1>
            <p class="text-sm text-gray-600 mt-1">后台管理系统</p>
        </div>
        
        <nav class="mt-6">
            <div class="px-4">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">用户管理</h3>
                <ul class="space-y-1">
                    <li><a href="61-用户详情页.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-user mr-3"></i>用户详情</a></li>
                    <li><a href="62-会员管理页.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-crown mr-3"></i>会员管理</a></li>
                    <li><a href="63-用户标签管理.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-tags mr-3"></i>用户标签</a></li>
                    <li><a href="64-积分管理.html" class="flex items-center px-3 py-2 text-white bg-green-600 rounded-lg"><i class="fas fa-coins mr-3"></i>积分管理</a></li>
                    <li><a href="65-权限配置.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-shield-alt mr-3"></i>权限配置</a></li>
                    <li><a href="66-用户分群.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-users mr-3"></i>用户分群</a></li>
                    <li><a href="67-行为分析.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-chart-line mr-3"></i>行为分析</a></li>
                    <li><a href="68-消息推送.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-bell mr-3"></i>消息推送</a></li>
                    <li><a href="69-黑名单管理.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-ban mr-3"></i>黑名单管理</a></li>
                    <li><a href="70-用户导出.html" class="flex items-center px-3 py-2 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors"><i class="fas fa-download mr-3"></i>用户导出</a></li>
                </ul>
            </div>
        </nav>
    </div>

    <!-- 主内容区域 -->
    <div class="lg:ml-64">
        <!-- 顶部导航栏 -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center">
                    <button id="sidebarToggle" class="lg:hidden p-2 rounded-md text-gray-600 hover:bg-gray-100">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="ml-4">
                        <h2 class="text-xl font-semibold text-gray-800">积分管理</h2>
                        <p class="text-sm text-gray-600">管理用户积分系统，设置积分规则和兑换商品</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="refreshData" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>刷新数据
                    </button>
                    <button id="exportReport" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        <i class="fas fa-download mr-2"></i>导出报告
                    </button>
                    <button id="addRule" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-plus mr-2"></i>新增规则
                    </button>
                    <div class="flex items-center space-x-2">
                        <img src="https://via.placeholder.com/32" alt="用户头像" class="w-8 h-8 rounded-full">
                        <span class="text-sm font-medium text-gray-700">管理员</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- 页面内容 -->
        <main class="p-6">
            <!-- 积分统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">总积分发放</p>
                            <p class="text-2xl font-bold text-gray-900 mt-1 points-animation">2,456,789</p>
                            <p class="text-sm text-green-600 mt-1">
                                <i class="fas fa-arrow-up mr-1"></i>+15.2% 本月
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-coins text-yellow-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">积分消耗</p>
                            <p class="text-2xl font-bold text-gray-900 mt-1">1,234,567</p>
                            <p class="text-sm text-blue-600 mt-1">
                                <i class="fas fa-shopping-cart mr-1"></i>兑换消耗
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-shopping-cart text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">活跃用户</p>
                            <p class="text-2xl font-bold text-gray-900 mt-1">8,456</p>
                            <p class="text-sm text-purple-600 mt-1">
                                <i class="fas fa-users mr-1"></i>有积分余额
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-purple-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">兑换订单</p>
                            <p class="text-2xl font-bold text-gray-900 mt-1">1,567</p>
                            <p class="text-sm text-green-600 mt-1">
                                <i class="fas fa-gift mr-1"></i>本月兑换
                            </p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-gift text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 积分趋势图表 -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">积分发放趋势</h3>
                        <select id="trendPeriod" class="px-3 py-1 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="7">近7天</option>
                            <option value="30" selected>近30天</option>
                            <option value="90">近90天</option>
                        </select>
                    </div>
                    <canvas id="pointsTrendChart" width="400" height="200"></canvas>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">积分来源分布</h3>
                        <button id="refreshChart" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <canvas id="pointsSourceChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- 积分规则管理 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-6">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">积分规则</h3>
                        <div class="flex items-center space-x-3">
                            <select id="ruleCategory" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                <option value="">全部规则</option>
                                <option value="earn">获得积分</option>
                                <option value="consume">消耗积分</option>
                                <option value="expire">过期规则</option>
                            </select>
                            <button id="batchEdit" class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                <i class="fas fa-edit mr-2"></i>批量编辑
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="rulesList" class="space-y-4">
                        <!-- 积分规则项将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 积分兑换商品 -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">兑换商品</h3>
                        <div class="flex items-center space-x-3">
                            <input type="text" id="searchProducts" placeholder="搜索商品..." class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <button id="addProduct" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                <i class="fas fa-plus mr-2"></i>添加商品
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="productsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                        <!-- 兑换商品将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 分页 -->
                <div class="px-6 py-4 border-t border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-700">
                            显示 <span class="font-medium">1</span> 到 <span class="font-medium">12</span> 条，共 <span class="font-medium">48</span> 条记录
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="px-3 py-1 text-sm text-gray-500 bg-white border border-gray-300 rounded hover:bg-gray-50">上一页</button>
                            <button class="px-3 py-1 text-sm text-white bg-green-500 border border-green-500 rounded">1</button>
                            <button class="px-3 py-1 text-sm text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50">2</button>
                            <button class="px-3 py-1 text-sm text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50">3</button>
                            <button class="px-3 py-1 text-sm text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50">4</button>
                            <button class="px-3 py-1 text-sm text-gray-500 bg-white border border-gray-300 rounded hover:bg-gray-50">下一页</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 积分规则模态框 -->
    <div id="ruleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 id="ruleModalTitle" class="text-lg font-semibold text-gray-900">新增积分规则</h3>
                    <button id="closeRuleModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="ruleForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">规则名称</label>
                            <input type="text" id="ruleName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="请输入规则名称" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">规则类型</label>
                            <select id="ruleType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                                <option value="">请选择类型</option>
                                <option value="register">注册奖励</option>
                                <option value="login">登录奖励</option>
                                <option value="purchase">购买奖励</option>
                                <option value="share">分享奖励</option>
                                <option value="review">评价奖励</option>
                                <option value="invite">邀请奖励</option>
                                <option value="task">任务奖励</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">积分数量</label>
                            <input type="number" id="rulePoints" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="请输入积分数量" min="1" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">触发条件</label>
                            <select id="ruleTrigger" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                <option value="once">仅一次</option>
                                <option value="daily">每日</option>
                                <option value="unlimited">无限制</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">规则描述</label>
                        <textarea id="ruleDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" rows="3" placeholder="请输入规则描述"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">生效时间</label>
                            <input type="datetime-local" id="ruleStartTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">失效时间</label>
                            <input type="datetime-local" id="ruleEndTime" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="ruleEnabled" class="rounded border-gray-300 text-green-600 focus:ring-green-500 mr-2" checked>
                            <span class="text-sm text-gray-700">启用规则</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="ruleNotify" class="rounded border-gray-300 text-green-600 focus:ring-green-500 mr-2">
                            <span class="text-sm text-gray-700">获得积分时通知用户</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button id="cancelRule" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">取消</button>
                <button id="saveRule" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">保存规则</button>
            </div>
        </div>
    </div>

    <!-- 兑换商品模态框 -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 id="productModalTitle" class="text-lg font-semibold text-gray-900">添加兑换商品</h3>
                    <button id="closeProductModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="productForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">商品名称</label>
                            <input type="text" id="productName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="请输入商品名称" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">所需积分</label>
                            <input type="number" id="productPoints" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="请输入所需积分" min="1" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">商品类型</label>
                            <select id="productType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                                <option value="">请选择类型</option>
                                <option value="physical">实物商品</option>
                                <option value="virtual">虚拟商品</option>
                                <option value="coupon">优惠券</option>
                                <option value="service">服务</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">库存数量</label>
                            <input type="number" id="productStock" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="请输入库存数量" min="0">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品描述</label>
                        <textarea id="productDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" rows="3" placeholder="请输入商品描述"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">商品图片</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <i class="fas fa-cloud-upload-alt text-gray-400 text-3xl mb-2"></i>
                            <p class="text-gray-500">点击上传或拖拽图片到此处</p>
                            <input type="file" class="hidden" accept="image/*">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">兑换限制</label>
                            <select id="productLimit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                                <option value="unlimited">无限制</option>
                                <option value="daily">每日限制</option>
                                <option value="monthly">每月限制</option>
                                <option value="total">总量限制</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">限制数量</label>
                            <input type="number" id="productLimitCount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" placeholder="请输入限制数量" min="1">
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="productEnabled" class="rounded border-gray-300 text-green-600 focus:ring-green-500 mr-2" checked>
                            <span class="text-sm text-gray-700">上架商品</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="productHot" class="rounded border-gray-300 text-green-600 focus:ring-green-500 mr-2">
                            <span class="text-sm text-gray-700">热门推荐</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                <button id="cancelProduct" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">取消</button>
                <button id="saveProduct" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">保存商品</button>
            </div>
        </div>
    </div>

    <script>
        // 模拟积分规则数据
        const rulesData = [
            {
                id: 1,
                name: '注册奖励',
                type: 'register',
                points: 100,
                trigger: 'once',
                description: '新用户注册即可获得100积分',
                enabled: true,
                startTime: '2024-01-01',
                endTime: null,
                usageCount: 1256
            },
            {
                id: 2,
                name: '每日签到',
                type: 'login',
                points: 10,
                trigger: 'daily',
                description: '每日首次登录获得10积分',
                enabled: true,
                startTime: '2024-01-01',
                endTime: null,
                usageCount: 8456
            },
            {
                id: 3,
                name: '购买奖励',
                type: 'purchase',
                points: 50,
                trigger: 'unlimited',
                description: '每消费100元获得50积分',
                enabled: true,
                startTime: '2024-01-01',
                endTime: null,
                usageCount: 3456
            },
            {
                id: 4,
                name: '分享奖励',
                type: 'share',
                points: 20,
                trigger: 'daily',
                description: '分享商品到社交媒体获得20积分',
                enabled: false,
                startTime: '2024-01-01',
                endTime: '2024-12-31',
                usageCount: 567
            }
        ];

        // 模拟兑换商品数据
        const productsData = [
            {
                id: 1,
                name: '香草种子礼盒',
                points: 500,
                type: 'physical',
                stock: 100,
                description: '包含薄荷、迷迭香、百里香等多种香草种子',
                image: 'https://via.placeholder.com/200x150',
                enabled: true,
                hot: true,
                exchangeCount: 156
            },
            {
                id: 2,
                name: '10元优惠券',
                points: 100,
                type: 'coupon',
                stock: 1000,
                description: '满50元可用，有效期30天',
                image: 'https://via.placeholder.com/200x150',
                enabled: true,
                hot: false,
                exchangeCount: 856
            },
            {
                id: 3,
                name: '种植指导服务',
                points: 200,
                type: 'service',
                stock: 50,
                description: '专业园艺师一对一种植指导',
                image: 'https://via.placeholder.com/200x150',
                enabled: true,
                hot: true,
                exchangeCount: 89
            },
            {
                id: 4,
                name: 'VIP会员月卡',
                points: 800,
                type: 'virtual',
                stock: 200,
                description: '享受VIP专属权益30天',
                image: 'https://via.placeholder.com/200x150',
                enabled: true,
                hot: false,
                exchangeCount: 234
            }
        ];

        // 侧边栏切换
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        });

        // 渲染积分规则列表
        function renderRulesList(data = rulesData) {
            const container = document.getElementById('rulesList');
            container.innerHTML = '';
            
            data.forEach(rule => {
                const typeNames = {
                    'register': '注册奖励',
                    'login': '登录奖励',
                    'purchase': '购买奖励',
                    'share': '分享奖励',
                    'review': '评价奖励',
                    'invite': '邀请奖励',
                    'task': '任务奖励'
                };
                
                const triggerNames = {
                    'once': '仅一次',
                    'daily': '每日',
                    'unlimited': '无限制'
                };
                
                const ruleItem = document.createElement('div');
                ruleItem.className = 'rule-item p-4 border border-gray-200 rounded-lg';
                ruleItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <h4 class="font-medium text-gray-900">${rule.name}</h4>
                                <span class="px-2 py-1 text-xs font-medium text-blue-600 bg-blue-100 rounded-full">${typeNames[rule.type]}</span>
                                <span class="px-2 py-1 text-xs font-medium text-purple-600 bg-purple-100 rounded-full">${triggerNames[rule.trigger]}</span>
                                <span class="px-2 py-1 text-xs font-medium ${rule.enabled ? 'text-green-600 bg-green-100' : 'text-red-600 bg-red-100'} rounded-full">
                                    ${rule.enabled ? '启用' : '禁用'}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${rule.description}</p>
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span><i class="fas fa-coins mr-1 text-yellow-500"></i>${rule.points} 积分</span>
                                <span><i class="fas fa-users mr-1 text-blue-500"></i>使用 ${rule.usageCount.toLocaleString()} 次</span>
                                <span><i class="fas fa-calendar mr-1 text-green-500"></i>创建于 ${rule.startTime}</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="p-2 text-gray-400 hover:text-blue-600" onclick="viewRule(${rule.id})" title="查看详情">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="p-2 text-gray-400 hover:text-green-600" onclick="editRule(${rule.id})" title="编辑规则">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="p-2 text-gray-400 hover:text-yellow-600" onclick="toggleRule(${rule.id})" title="${rule.enabled ? '禁用' : '启用'}规则">
                                <i class="fas fa-${rule.enabled ? 'pause' : 'play'}"></i>
                            </button>
                            <button class="p-2 text-gray-400 hover:text-red-600" onclick="deleteRule(${rule.id})" title="删除规则">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(ruleItem);
            });
        }

        // 渲染兑换商品列表
        function renderProductsList(data = productsData) {
            const container = document.getElementById('productsList');
            container.innerHTML = '';
            
            data.forEach(product => {
                const typeNames = {
                    'physical': '实物商品',
                    'virtual': '虚拟商品',
                    'coupon': '优惠券',
                    'service': '服务'
                };
                
                const productCard = document.createElement('div');
                productCard.className = 'bg-gray-50 rounded-lg border border-gray-200 overflow-hidden card-hover';
                productCard.innerHTML = `
                    <div class="relative">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-32 object-cover">
                        ${product.hot ? '<div class="absolute top-2 left-2 px-2 py-1 text-xs font-medium text-white bg-red-500 rounded-full">热门</div>' : ''}
                        <div class="absolute top-2 right-2 px-2 py-1 text-xs font-medium ${product.enabled ? 'text-green-600 bg-green-100' : 'text-red-600 bg-red-100'} rounded-full">
                            ${product.enabled ? '上架' : '下架'}
                        </div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-medium text-gray-900 mb-1">${product.name}</h4>
                        <p class="text-xs text-gray-500 mb-2">${typeNames[product.type]}</p>
                        <p class="text-sm text-gray-600 mb-3 line-clamp-2">${product.description}</p>
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-1">
                                <i class="fas fa-coins text-yellow-500"></i>
                                <span class="font-medium text-gray-900">${product.points}</span>
                                <span class="text-sm text-gray-500">积分</span>
                            </div>
                            <span class="text-sm text-gray-500">库存 ${product.stock}</span>
                        </div>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-3">
                            <span>已兑换 ${product.exchangeCount} 次</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="flex-1 px-3 py-1 text-xs text-blue-600 bg-blue-50 rounded hover:bg-blue-100" onclick="viewProduct(${product.id})">
                                查看
                            </button>
                            <button class="flex-1 px-3 py-1 text-xs text-green-600 bg-green-50 rounded hover:bg-green-100" onclick="editProduct(${product.id})">
                                编辑
                            </button>
                            <button class="flex-1 px-3 py-1 text-xs text-red-600 bg-red-50 rounded hover:bg-red-100" onclick="deleteProduct(${product.id})">
                                删除
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(productCard);
            });
        }

        // 初始化图表
        function initCharts() {
            // 积分发放趋势图
            const trendCtx = document.getElementById('pointsTrendChart').getContext('2d');
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                    datasets: [{
                        label: '积分发放',
                        data: [12000, 19000, 15000, 25000, 22000, 30000],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }, {
                        label: '积分消耗',
                        data: [8000, 12000, 10000, 18000, 16000, 20000],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // 积分来源分布图
            const sourceCtx = document.getElementById('pointsSourceChart').getContext('2d');
            new Chart(sourceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['购买奖励', '签到奖励', '分享奖励', '邀请奖励', '任务奖励'],
                    datasets: [{
                        data: [45, 25, 15, 10, 5],
                        backgroundColor: [
                            '#10b981',
                            '#3b82f6',
                            '#f59e0b',
                            '#ef4444',
                            '#8b5cf6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // 规则操作函数
        function viewRule(id) {
            alert(`查看规则详情 ID: ${id}`);
        }

        function editRule(id) {
            const rule = rulesData.find(r => r.id === id);
            if (rule) {
                document.getElementById('ruleModalTitle').textContent = '编辑积分规则';
                document.getElementById('ruleName').value = rule.name;
                document.getElementById('ruleType').value = rule.type;
                document.getElementById('rulePoints').value = rule.points;
                document.getElementById('ruleTrigger').value = rule.trigger;
                document.getElementById('ruleDescription').value = rule.description;
                document.getElementById('ruleEnabled').checked = rule.enabled;
                
                document.getElementById('ruleModal').classList.remove('hidden');
                document.getElementById('ruleModal').classList.add('flex');
            }
        }

        function toggleRule(id) {
            const rule = rulesData.find(r => r.id === id);
            if (rule) {
                rule.enabled = !rule.enabled;
                renderRulesList();
                alert(`规则已${rule.enabled ? '启用' : '禁用'}`);
            }
        }

        function deleteRule(id) {
            if (confirm('确定要删除这个规则吗？')) {
                alert(`删除规则 ID: ${id}`);
                renderRulesList();
            }
        }

        // 商品操作函数
        function viewProduct(id) {
            alert(`查看商品详情 ID: ${id}`);
        }

        function editProduct(id) {
            const product = productsData.find(p => p.id === id);
            if (product) {
                document.getElementById('productModalTitle').textContent = '编辑兑换商品';
                document.getElementById('productName').value = product.name;
                document.getElementById('productPoints').value = product.points;
                document.getElementById('productType').value = product.type;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productEnabled').checked = product.enabled;
                document.getElementById('productHot').checked = product.hot;
                
                document.getElementById('productModal').classList.remove('hidden');
                document.getElementById('productModal').classList.add('flex');
            }
        }

        function deleteProduct(id) {
            if (confirm('确定要删除这个商品吗？')) {
                alert(`删除商品 ID: ${id}`);
                renderProductsList();
            }
        }

        // 模态框控制
        document.getElementById('addRule').addEventListener('click', function() {
            document.getElementById('ruleModalTitle').textContent = '新增积分规则';
            document.getElementById('ruleForm').reset();
            document.getElementById('ruleModal').classList.remove('hidden');
            document.getElementById('ruleModal').classList.add('flex');
        });

        document.getElementById('addProduct').addEventListener('click', function() {
            document.getElementById('productModalTitle').textContent = '添加兑换商品';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').classList.remove('hidden');
            document.getElementById('productModal').classList.add('flex');
        });

        // 关闭模态框
        document.getElementById('closeRuleModal').addEventListener('click', function() {
            document.getElementById('ruleModal').classList.add('hidden');
            document.getElementById('ruleModal').classList.remove('flex');
        });

        document.getElementById('closeProductModal').addEventListener('click', function() {
            document.getElementById('productModal').classList.add('hidden');
            document.getElementById('productModal').classList.remove('flex');
        });

        // 保存规则
        document.getElementById('saveRule').addEventListener('click', function() {
            alert('积分规则保存成功！');
            document.getElementById('ruleModal').classList.add('hidden');
            document.getElementById('ruleModal').classList.remove('flex');
            renderRulesList();
        });

        // 保存商品
        document.getElementById('saveProduct').addEventListener('click', function() {
            alert('兑换商品保存成功！');
            document.getElementById('productModal').classList.add('hidden');
            document.getElementById('productModal').classList.remove('flex');
            renderProductsList();
        });

        // 搜索功能
        document.getElementById('searchProducts').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredData = productsData.filter(product => 
                product.name.toLowerCase().includes(searchTerm) ||
                product.description.toLowerCase().includes(searchTerm)
            );
            renderProductsList(filteredData);
        });

        // 规则分类筛选
        document.getElementById('ruleCategory').addEventListener('change', function() {
            const category = this.value;
            let filteredData = rulesData;
            
            if (category === 'earn') {
                filteredData = rulesData.filter(rule => ['register', 'login', 'purchase', 'share', 'review', 'invite', 'task'].includes(rule.type));
            } else if (category === 'consume') {
                filteredData = rulesData.filter(rule => rule.type === 'consume');
            } else if (category === 'expire') {
                filteredData = rulesData.filter(rule => rule.endTime && new Date(rule.endTime) < new Date());
            }
            
            renderRulesList(filteredData);
        });

        // 刷新数据
        document.getElementById('refreshData').addEventListener('click', function() {
            renderRulesList();
            renderProductsList();
            alert('数据刷新成功！');
        });

        // 导出报告
        document.getElementById('exportReport').addEventListener('click', function() {
            alert('积分报告导出成功！');
        });

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderRulesList();
            renderProductsList();
            initCharts();
            console.log('积分管理页面初始化完成');
        });
    </script>
</body>
</html>