<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>权限管理 - 香草生活后台管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .permission-tree {
            max-height: 400px;
            overflow-y: auto;
        }
        .role-card:hover {
            transform: translateY(-2px);
            transition: transform 0.2s ease;
        }
    </style>

    <style>
        /* 隐藏侧边栏 */
        #sidebar, .sidebar-hidden { display: none !important; }
        /* 调整主内容区域 */
        .lg\:ml-64 { margin-left: 0 !important; }
        /* 隐藏侧边栏切换按钮 */
        #sidebarToggle, #sidebar-toggle { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 侧边栏 -->
    <div id="sidebar" class="fixed left-0 top-0 w-64 h-full bg-white shadow-lg sidebar-transition z-30">
        <!-- Logo -->
        <div class="p-6 border-b">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                    <i class="fas fa-leaf text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800">香草生活</h1>
                    <p class="text-sm text-gray-500">后台管理系统</p>
                </div>
            </div>
        </div>
        
        <!-- 导航菜单 -->
        <nav class="mt-6">
            <div class="px-4">
                <div class="space-y-2">
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-tachometer-alt w-5 h-5 mr-3"></i>
                        <span>仪表盘</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-users w-5 h-5 mr-3"></i>
                        <span>用户画像</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 bg-blue-50 text-blue-600 rounded-lg">
                        <i class="fas fa-shield-alt w-5 h-5 mr-3"></i>
                        <span>权限管理</span>
                    </a>
                    <a href="#" class="flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-lg">
                        <i class="fas fa-cog w-5 h-5 mr-3"></i>
                        <span>系统设置</span>
                    </a>
                </div>
            </div>
        </nav>
    </div>

    <!-- 主内容区域 -->
    <div class="ml-64">
        <!-- 顶部导航栏 -->
        <header class="bg-white shadow-sm border-b">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4">
                    <button id="sidebarToggle" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-800">权限管理</h2>
                        <p class="text-sm text-gray-500">管理系统角色和权限配置</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bell text-xl"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <img src="https://via.placeholder.com/32" alt="Avatar" class="w-8 h-8 rounded-full">
                        <span class="text-sm text-gray-700">管理员</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- 页面内容 -->
        <main class="p-6">
            <!-- 统计卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">系统角色</p>
                            <p class="text-2xl font-bold text-gray-900">8</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-user-tag text-blue-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <span class="text-green-600">+2</span>
                        <span class="text-gray-500 ml-1">本月新增</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">权限节点</p>
                            <p class="text-2xl font-bold text-gray-900">156</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-key text-green-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <span class="text-green-600">+12</span>
                        <span class="text-gray-500 ml-1">本月新增</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">活跃用户</p>
                            <p class="text-2xl font-bold text-gray-900">1,234</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-yellow-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <span class="text-green-600">+5.2%</span>
                        <span class="text-gray-500 ml-1">较上月</span>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">安全等级</p>
                            <p class="text-2xl font-bold text-gray-900">高</p>
                        </div>
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-shield-alt text-red-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center text-sm">
                        <span class="text-green-600">安全</span>
                        <span class="text-gray-500 ml-1">系统状态</span>
                    </div>
                </div>
            </div>

            <!-- 操作栏 -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="p-4 border-b">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="relative">
                                <input type="text" placeholder="搜索角色或权限..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                            <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option>全部角色</option>
                                <option>管理员</option>
                                <option>编辑者</option>
                                <option>查看者</option>
                            </select>
                            <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option>全部状态</option>
                                <option>启用</option>
                                <option>禁用</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button class="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200">
                                <i class="fas fa-download mr-2"></i>导出权限
                            </button>
                            <button onclick="openCreateRoleModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-plus mr-2"></i>创建角色
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 标签页导航 -->
            <div class="bg-white rounded-lg shadow">
                <div class="border-b">
                    <nav class="flex space-x-8 px-6" id="permissionTabs">
                        <button data-tab="roles" class="py-4 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm">
                            角色管理
                        </button>
                        <button data-tab="permissions" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                            权限配置
                        </button>
                        <button data-tab="users" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                            用户分配
                        </button>
                        <button data-tab="logs" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                            操作日志
                        </button>
                        <button data-tab="security" class="py-4 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm">
                            安全设置
                        </button>
                    </nav>
                </div>

                <!-- 角色管理标签页 -->
                <div id="rolesTab" class="tab-content active p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="rolesGrid">
                        <!-- 角色卡片将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 权限配置标签页 -->
                <div id="permissionsTab" class="tab-content p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4">权限树结构</h3>
                            <div class="permission-tree" id="permissionTree">
                                <!-- 权限树将通过JavaScript动态生成 -->
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4">权限详情</h3>
                            <div id="permissionDetails">
                                <p class="text-gray-500 text-center py-8">请选择左侧权限节点查看详情</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 用户分配标签页 -->
                <div id="usersTab" class="tab-content p-6">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">用户</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">角色</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">部门</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最后登录</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="usersTableBody">
                                <!-- 用户数据将通过JavaScript动态生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 操作日志标签页 -->
                <div id="logsTab" class="tab-content p-6">
                    <div class="space-y-4" id="operationLogs">
                        <!-- 操作日志将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 安全设置标签页 -->
                <div id="securityTab" class="tab-content p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-4">登录安全</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">强制双因子认证</p>
                                            <p class="text-sm text-gray-500">要求所有管理员启用2FA</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">IP白名单</p>
                                            <p class="text-sm text-gray-500">限制管理后台访问IP</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">会话超时</p>
                                            <p class="text-sm text-gray-500">自动登出时间设置</p>
                                        </div>
                                        <select class="px-3 py-1 border border-gray-300 rounded">
                                            <option>30分钟</option>
                                            <option>1小时</option>
                                            <option>2小时</option>
                                            <option>4小时</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-4">密码策略</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">最小长度</p>
                                            <p class="text-sm text-gray-500">密码最少字符数</p>
                                        </div>
                                        <input type="number" value="8" min="6" max="20" class="w-16 px-2 py-1 border border-gray-300 rounded">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">复杂度要求</p>
                                            <p class="text-sm text-gray-500">包含大小写、数字、特殊字符</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium">定期更换</p>
                                            <p class="text-sm text-gray-500">强制定期修改密码</p>
                                        </div>
                                        <select class="px-3 py-1 border border-gray-300 rounded">
                                            <option>30天</option>
                                            <option>60天</option>
                                            <option>90天</option>
                                            <option>永不</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 创建角色模态框 -->
    <div id="createRoleModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold">创建新角色</h3>
                        <button onclick="closeCreateRoleModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <form class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">角色名称</label>
                                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="输入角色名称">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">角色标识</label>
                                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="role_key">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">角色描述</label>
                            <textarea class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" placeholder="描述角色的职责和权限范围"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">权限配置</label>
                            <div class="border border-gray-300 rounded-lg p-4 max-h-60 overflow-y-auto">
                                <div class="space-y-2" id="permissionCheckboxes">
                                    <!-- 权限复选框将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="p-6 border-t bg-gray-50 flex justify-end space-x-3">
                    <button onclick="closeCreateRoleModal()" class="px-4 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300">
                        取消
                    </button>
                    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        创建角色
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 侧边栏切换
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        });

        // 标签页切换
        function initTabs() {
            const tabs = document.querySelectorAll('#permissionTabs button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // 移除所有活跃状态
                    tabs.forEach(t => {
                        t.classList.remove('border-blue-500', 'text-blue-600');
                        t.classList.add('border-transparent', 'text-gray-500');
                    });
                    
                    // 添加当前标签活跃状态
                    this.classList.remove('border-transparent', 'text-gray-500');
                    this.classList.add('border-blue-500', 'text-blue-600');
                    
                    // 隐藏所有标签页内容
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 显示目标标签页内容
                    const targetContent = document.getElementById(targetTab + 'Tab');
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
        }

        // 渲染角色卡片
        function renderRoles() {
            const roles = [
                {
                    id: 1,
                    name: '超级管理员',
                    key: 'super_admin',
                    description: '拥有系统所有权限，可以管理所有功能模块',
                    userCount: 2,
                    permissions: 156,
                    status: 'active',
                    color: 'red'
                },
                {
                    id: 2,
                    name: '系统管理员',
                    key: 'admin',
                    description: '负责系统配置和用户管理',
                    userCount: 5,
                    permissions: 89,
                    status: 'active',
                    color: 'blue'
                },
                {
                    id: 3,
                    name: '内容编辑',
                    key: 'editor',
                    description: '负责内容创建、编辑和发布',
                    userCount: 12,
                    permissions: 45,
                    status: 'active',
                    color: 'green'
                },
                {
                    id: 4,
                    name: '数据分析师',
                    key: 'analyst',
                    description: '负责数据分析和报表生成',
                    userCount: 8,
                    permissions: 32,
                    status: 'active',
                    color: 'purple'
                },
                {
                    id: 5,
                    name: '客服专员',
                    key: 'support',
                    description: '负责用户咨询和问题处理',
                    userCount: 15,
                    permissions: 28,
                    status: 'active',
                    color: 'yellow'
                },
                {
                    id: 6,
                    name: '财务专员',
                    key: 'finance',
                    description: '负责财务数据和结算管理',
                    userCount: 3,
                    permissions: 24,
                    status: 'inactive',
                    color: 'indigo'
                }
            ];

            const rolesGrid = document.getElementById('rolesGrid');
            rolesGrid.innerHTML = roles.map(role => `
                <div class="role-card bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-${role.color}-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-user-tag text-${role.color}-600"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">${role.name}</h3>
                                <p class="text-sm text-gray-500">${role.key}</p>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            role.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                        }">
                            ${role.status === 'active' ? '启用' : '禁用'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">${role.description}</p>
                    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                        <span><i class="fas fa-users mr-1"></i>${role.userCount} 用户</span>
                        <span><i class="fas fa-key mr-1"></i>${role.permissions} 权限</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="editRole(${role.id})" class="flex-1 px-3 py-2 text-sm bg-blue-50 text-blue-600 rounded hover:bg-blue-100">
                            <i class="fas fa-edit mr-1"></i>编辑
                        </button>
                        <button onclick="viewRoleUsers(${role.id})" class="flex-1 px-3 py-2 text-sm bg-gray-50 text-gray-600 rounded hover:bg-gray-100">
                            <i class="fas fa-users mr-1"></i>用户
                        </button>
                        <button onclick="toggleRoleStatus(${role.id})" class="px-3 py-2 text-sm ${
                            role.status === 'active' ? 'bg-red-50 text-red-600 hover:bg-red-100' : 'bg-green-50 text-green-600 hover:bg-green-100'
                        } rounded">
                            <i class="fas fa-${role.status === 'active' ? 'ban' : 'check'}"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 渲染权限树
        function renderPermissionTree() {
            const permissions = [
                {
                    id: 1,
                    name: '系统管理',
                    icon: 'cog',
                    children: [
                        { id: 11, name: '用户管理', icon: 'users' },
                        { id: 12, name: '角色管理', icon: 'user-tag' },
                        { id: 13, name: '权限配置', icon: 'key' },
                        { id: 14, name: '系统设置', icon: 'cogs' }
                    ]
                },
                {
                    id: 2,
                    name: '内容管理',
                    icon: 'file-alt',
                    children: [
                        { id: 21, name: '文章管理', icon: 'newspaper' },
                        { id: 22, name: '分类管理', icon: 'tags' },
                        { id: 23, name: '评论管理', icon: 'comments' },
                        { id: 24, name: '媒体库', icon: 'images' }
                    ]
                },
                {
                    id: 3,
                    name: '商品管理',
                    icon: 'box',
                    children: [
                        { id: 31, name: '商品列表', icon: 'list' },
                        { id: 32, name: '分类管理', icon: 'sitemap' },
                        { id: 33, name: '库存管理', icon: 'warehouse' },
                        { id: 34, name: '价格管理', icon: 'dollar-sign' }
                    ]
                },
                {
                    id: 4,
                    name: '订单管理',
                    icon: 'shopping-cart',
                    children: [
                        { id: 41, name: '订单列表', icon: 'list-alt' },
                        { id: 42, name: '退换货', icon: 'undo' },
                        { id: 43, name: '物流管理', icon: 'truck' },
                        { id: 44, name: '售后服务', icon: 'headset' }
                    ]
                }
            ];

            const permissionTree = document.getElementById('permissionTree');
            permissionTree.innerHTML = permissions.map(permission => `
                <div class="mb-4">
                    <div class="flex items-center p-2 hover:bg-gray-100 rounded cursor-pointer" onclick="togglePermissionNode(${permission.id})">
                        <i class="fas fa-chevron-right mr-2 text-gray-400 transform transition-transform" id="arrow-${permission.id}"></i>
                        <i class="fas fa-${permission.icon} mr-2 text-gray-600"></i>
                        <span class="font-medium">${permission.name}</span>
                    </div>
                    <div class="ml-6 hidden" id="children-${permission.id}">
                        ${permission.children.map(child => `
                            <div class="flex items-center p-2 hover:bg-gray-100 rounded cursor-pointer" onclick="selectPermission(${child.id}, '${child.name}')">
                                <i class="fas fa-${child.icon} mr-2 text-gray-500"></i>
                                <span>${child.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // 切换权限节点
        function togglePermissionNode(id) {
            const arrow = document.getElementById(`arrow-${id}`);
            const children = document.getElementById(`children-${id}`);
            
            if (children.classList.contains('hidden')) {
                children.classList.remove('hidden');
                arrow.classList.add('rotate-90');
            } else {
                children.classList.add('hidden');
                arrow.classList.remove('rotate-90');
            }
        }

        // 选择权限
        function selectPermission(id, name) {
            const permissionDetails = document.getElementById('permissionDetails');
            permissionDetails.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <h4 class="text-lg font-semibold">${name}</h4>
                        <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full">启用</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">权限ID:</span>
                            <span class="ml-2 font-mono">${id}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">权限类型:</span>
                            <span class="ml-2">功能权限</span>
                        </div>
                        <div>
                            <span class="text-gray-500">创建时间:</span>
                            <span class="ml-2">2024-01-15</span>
                        </div>
                        <div>
                            <span class="text-gray-500">更新时间:</span>
                            <span class="ml-2">2024-01-20</span>
                        </div>
                    </div>
                    <div>
                        <span class="text-gray-500">权限描述:</span>
                        <p class="mt-1 text-gray-700">允许用户访问和操作${name}相关的所有功能，包括查看、创建、编辑和删除等操作。</p>
                    </div>
                    <div>
                        <span class="text-gray-500">关联角色:</span>
                        <div class="mt-2 flex flex-wrap gap-2">
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">超级管理员</span>
                            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">系统管理员</span>
                        </div>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                            <i class="fas fa-edit mr-1"></i>编辑权限
                        </button>
                        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            <i class="fas fa-ban mr-1"></i>禁用权限
                        </button>
                    </div>
                </div>
            `;
        }

        // 渲染用户表格
        function renderUsersTable() {
            const users = [
                {
                    id: 1,
                    name: '张三',
                    email: 'zhangsan@example.com',
                    role: '超级管理员',
                    department: '技术部',
                    status: 'active',
                    lastLogin: '2024-01-20 14:30'
                },
                {
                    id: 2,
                    name: '李四',
                    email: 'lisi@example.com',
                    role: '系统管理员',
                    department: '运营部',
                    status: 'active',
                    lastLogin: '2024-01-20 10:15'
                },
                {
                    id: 3,
                    name: '王五',
                    email: 'wangwu@example.com',
                    role: '内容编辑',
                    department: '内容部',
                    status: 'active',
                    lastLogin: '2024-01-19 16:45'
                },
                {
                    id: 4,
                    name: '赵六',
                    email: 'zhaoliu@example.com',
                    role: '数据分析师',
                    department: '数据部',
                    status: 'inactive',
                    lastLogin: '2024-01-18 09:20'
                }
            ];

            const usersTableBody = document.getElementById('usersTableBody');
            usersTableBody.innerHTML = users.map(user => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <img class="h-8 w-8 rounded-full" src="https://via.placeholder.com/32" alt="">
                            <div class="ml-3">
                                <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                <div class="text-sm text-gray-500">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">${user.role}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.department}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${
                            user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${user.status === 'active' ? '正常' : '禁用'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.lastLogin}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-900">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="viewUserPermissions(${user.id})" class="text-green-600 hover:text-green-900">
                                <i class="fas fa-key"></i>
                            </button>
                            <button onclick="toggleUserStatus(${user.id})" class="text-red-600 hover:text-red-900">
                                <i class="fas fa-ban"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // 渲染操作日志
        function renderOperationLogs() {
            const logs = [
                {
                    id: 1,
                    user: '张三',
                    action: '创建角色',
                    target: '内容审核员',
                    time: '2024-01-20 14:30:25',
                    ip: '192.168.1.100',
                    status: 'success'
                },
                {
                    id: 2,
                    user: '李四',
                    action: '修改权限',
                    target: '用户管理权限',
                    time: '2024-01-20 10:15:42',
                    ip: '192.168.1.101',
                    status: 'success'
                },
                {
                    id: 3,
                    user: '王五',
                    action: '删除用户',
                    target: '测试账号',
                    time: '2024-01-19 16:45:18',
                    ip: '192.168.1.102',
                    status: 'failed'
                },
                {
                    id: 4,
                    user: '赵六',
                    action: '登录系统',
                    target: '后台管理',
                    time: '2024-01-19 09:20:33',
                    ip: '192.168.1.103',
                    status: 'success'
                }
            ];

            const operationLogs = document.getElementById('operationLogs');
            operationLogs.innerHTML = logs.map(log => `
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-gray-600"></i>
                            </div>
                            <div>
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium">${log.user}</span>
                                    <span class="text-gray-500">${log.action}</span>
                                    <span class="font-medium">${log.target}</span>
                                </div>
                                <div class="text-sm text-gray-500 mt-1">
                                    <i class="fas fa-clock mr-1"></i>${log.time}
                                    <i class="fas fa-map-marker-alt ml-3 mr-1"></i>${log.ip}
                                </div>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            log.status === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${log.status === 'success' ? '成功' : '失败'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // 模态框控制
        function openCreateRoleModal() {
            document.getElementById('createRoleModal').classList.remove('hidden');
            renderPermissionCheckboxes();
        }

        function closeCreateRoleModal() {
            document.getElementById('createRoleModal').classList.add('hidden');
        }

        // 渲染权限复选框
        function renderPermissionCheckboxes() {
            const permissions = [
                { id: 1, name: '用户管理', category: '系统管理' },
                { id: 2, name: '角色管理', category: '系统管理' },
                { id: 3, name: '权限配置', category: '系统管理' },
                { id: 4, name: '内容管理', category: '内容管理' },
                { id: 5, name: '商品管理', category: '商品管理' },
                { id: 6, name: '订单管理', category: '订单管理' }
            ];

            const permissionCheckboxes = document.getElementById('permissionCheckboxes');
            const categories = [...new Set(permissions.map(p => p.category))];
            
            permissionCheckboxes.innerHTML = categories.map(category => `
                <div class="mb-4">
                    <h4 class="font-medium text-gray-900 mb-2">${category}</h4>
                    <div class="space-y-2 ml-4">
                        ${permissions.filter(p => p.category === category).map(permission => `
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">${permission.name}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // 角色操作函数
        function editRole(id) {
            console.log('编辑角色:', id);
        }

        function viewRoleUsers(id) {
            console.log('查看角色用户:', id);
        }

        function toggleRoleStatus(id) {
            console.log('切换角色状态:', id);
        }

        // 用户操作函数
        function editUser(id) {
            console.log('编辑用户:', id);
        }

        function viewUserPermissions(id) {
            console.log('查看用户权限:', id);
        }

        function toggleUserStatus(id) {
            console.log('切换用户状态:', id);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initTabs();
            renderRoles();
            renderPermissionTree();
            renderUsersTable();
            renderOperationLogs();
        });
    </script>
</body>
</html>